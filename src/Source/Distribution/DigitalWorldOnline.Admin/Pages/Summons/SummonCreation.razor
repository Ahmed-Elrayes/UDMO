@page "/summons/create"
@attribute [Authorize(Roles = "Administrator, GameMaster")]
@using DigitalWorldOnline.Commons.ViewModel.Asset;

<MudPaper Style="overflow-x: hidden;
        padding: 20px;
        margin-top: 15px;">
    <Loader Loading="@Loading">
        <EditForm Model="@_summon" OnValidSubmit="Create">
            <MudGrid>
                <MudItem xs="12">
                    <MudStack Row="true" Spacing="2">
                        <MudIcon Icon="@Icons.Material.Filled.SimCardDownload" Class="icon-title"></MudIcon>
                        <MudText Typo="Typo.h5"><b>New summon config</b></MudText>
                    </MudStack>
                </MudItem>
                <MudItem xs="12" xl="12" sm="12">
                    <MudAutocomplete @bind-Value="_summon.ItemInfo"
                                     @ref="_selectedItemAsset"
                                     ToStringFunc="@(e => e == null ? null : $"{e.ItemId} - {e.Name}")"
                                     T="ItemAssetViewModel"
                                     Label="Summon Item"
                                     SearchFunc="GetItemAssets"
                                     Variant="Variant.Outlined"
                                     Class="docs-search-bar"
                                     AdornmentIcon="@Icons.Material.Filled.Search">
                        <ItemTemplate Context="itemAssetResult">
                            <MudText><strong>@itemAssetResult.ItemId</strong> - @itemAssetResult.Name</MudText>
                        </ItemTemplate>
                    </MudAutocomplete>
                </MudItem>
                <MudItem xs="12" xl="12" sm="12">
                    <MudAutocomplete @ref="_selectedMobAsset"
                                     ToStringFunc="@(e => e == null ? null : $"{e.Type} - {e.Name}")"
                                     T="MobAssetViewModel"
                                     Label="Mob Template"
                                     SearchFunc="GetMobAssets"
                                     ValueChanged="UpdateMobFields"
                                     Variant="Variant.Outlined"
                                     Class="docs-search-bar"
                                     AdornmentIcon="@Icons.Material.Filled.Search">
                        <ItemTemplate Context="result">
                            <MudText><strong>@result.Type</strong> - @result.Name</MudText>
                        </ItemTemplate>
                    </MudAutocomplete>
                </MudItem>

                <MudItem xs="12" xl="12" sm="12">
                    <MudExpansionPanels Elevation="2" Style="padding-bottom:15px">
                        @if (_summon.SummonedMobs.Any())
                        {
                            <MudExpansionPanel IsInitiallyExpanded>
                                <TitleContent>
                                    <MudStack Row="true" Spacing="2">
                                        <MudText>Base Information</MudText>
                                    </MudStack>
                                </TitleContent>
                                <ChildContent>
                                    <MudGrid>
                                        <MudItem xs="3" xl="3" sm="3">
                                            <MudNumericField @bind-Value="_summon.SummonedMobs.Last().Type"
                                                             Label="Type"
                                                             T="int"
                                                             Variant="Variant.Outlined"
                                                             Required
                                                             RequiredError="Required"
                                                             Min="0"
                                                             Max="int.MaxValue">
                                            </MudNumericField>
                                        </MudItem>
                                        <MudItem xs="3" xl="3" sm="3">
                                            <MudNumericField @bind-Value="_summon.SummonedMobs.Last().Model"
                                                             Label="Model"
                                                             T="int"
                                                             Variant="Variant.Outlined"
                                                             Required
                                                             RequiredError="Required"
                                                             Min="0"
                                                             Max="int.MaxValue">
                                            </MudNumericField>
                                        </MudItem>
                                        <MudItem xs="3" xl="3" sm="3">
                                            <MudTextField @bind-Value="_summon.SummonedMobs.Last().Name"
                                                          Label="Alias Name"
                                                          T="string"
                                                          Variant="Variant.Outlined"
                                                          Required
                                                          RequiredError="Required">
                                            </MudTextField>
                                        </MudItem>
                                        <MudItem xs="3" xl="3" sm="3">
                                            <MudNumericField @bind-Value="_summon.SummonedMobs.Last().Level"
                                                             Label="Level"
                                                             T="byte"
                                                             Variant="Variant.Outlined"
                                                             Required
                                                             RequiredError="Required"
                                                             Min="1"
                                                             Max="byte.MaxValue">
                                            </MudNumericField>
                                        </MudItem>
                                        <MudItem xs="3" xl="3" sm="3">
                                            <MudNumericField @bind-Value="_summon.SummonedMobs.Last().Duration"
                                                             Label="Respawn Time"
                                                             T="int"
                                                             Variant="Variant.Outlined"
                                                             Required
                                                             RequiredError="Required"
                                                             Min="5"
                                                             Max="int.MaxValue">
                                            </MudNumericField>
                                        </MudItem>
                                    </MudGrid>
                                </ChildContent>
                            </MudExpansionPanel>

                            <MudExpansionPanel>
                                <TitleContent>
                                    <MudStack Row="true" Spacing="2">
                                        <MudText>Status Information</MudText>
                                    </MudStack>
                                </TitleContent>
                                <ChildContent>
                                    <MudGrid>
                                        <MudItem xs="3" xl="3" sm="3">
                                            <MudNumericField @bind-Value="_summon.SummonedMobs.Last().ARValue"
                                                             Label="Attack Range"
                                                             T="int"
                                                             Variant="Variant.Outlined"
                                                             Required
                                                             RequiredError="Required"
                                                             Min="150"
                                                             Max="int.MaxValue">
                                            </MudNumericField>
                                        </MudItem>
                                        <MudItem xs="3" xl="3" sm="3">
                                            <MudNumericField @bind-Value="_summon.SummonedMobs.Last().ASValue"
                                                             Label="Attack Speed"
                                                             T="int"
                                                             Variant="Variant.Outlined"
                                                             Required
                                                             RequiredError="Required"
                                                             Min="1000"
                                                             Max="int.MaxValue">
                                            </MudNumericField>
                                        </MudItem>
                                        <MudItem xs="3" xl="3" sm="3">
                                            <MudNumericField @bind-Value="_summon.SummonedMobs.Last().ATValue"
                                                             Label="Attack Damage"
                                                             T="int"
                                                             Variant="Variant.Outlined"
                                                             Required
                                                             RequiredError="Required"
                                                             Min="0"
                                                             Max="int.MaxValue">
                                            </MudNumericField>
                                        </MudItem>
                                    </MudGrid>
                                </ChildContent>
                            </MudExpansionPanel>
                        }
                        else
                        {
                            <MudText>No summoned mob available.</MudText>
                        }
                    </MudExpansionPanels>
                </MudItem>
                <MudItem xs="12" xl="12" sm="12">
                </MudItem>

                <MudItem xs="12" xl="12" sm="12">
                    <MudStack Row="true" Spacing="2">
                        <MudButton Color="Color.Primary" Variant="Variant.Filled" ButtonType="ButtonType.Submit">
                            Create
                        </MudButton>
                        <MudButton Color="Color.Inherit" Variant="Variant.Filled" ButtonType="ButtonType.Button"
                                   OnClick="Return">Cancel
                        </MudButton>
                    </MudStack>
                </MudItem>
            </MudGrid>
        </EditForm>
    </Loader>
</MudPaper>
